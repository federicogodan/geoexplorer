<% extends ./base.html %>
<% subskin extrahead %>
    <!-- OpenLayers resources -->
    <link rel="stylesheet" type="text/css" href="externals/openlayers/theme/default/style.css">
    <script type="text/javascript" src="script/OpenLayers.js"></script>

    <!-- GeoExt resources -->
    <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/popup.css">
    <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/layerlegend.css">
    <link rel="stylesheet" type="text/css" href="externals/geoext/resources/css/gxtheme-gray.css">
    <script type="text/javascript" src="script/GeoExt.js"></script> 

    <!-- gxp resources -->
    <link rel="stylesheet" type="text/css" href="externals/gxp/src/theme/all.css">
    <script type="text/javascript" src="script/gxp.js"></script> 

    <!-- proj4js resources -->
    <script type="text/javascript" src="script/proj4js.js"></script>

    <!-- GeoExplorer resources -->
    <link rel="stylesheet" type="text/css" href="theme/app/geoexplorer.css" />
    <link rel="stylesheet" type="text/css" href="theme/app/fdh.css" />
    <!--[if IE]><link rel="stylesheet" type="text/css" href="theme/app/ie.css"/><![endif]-->        

    <script type="text/javascript" src="script/GeoExplorer.js"></script>
    <script type="text/javascript" src="script/ux.js"></script>
    
    <script>
        
        var app;
        
        var modified = false; var mapId;

        //
        // Parsing the request to get the parameters
        //
        var params = location.search.replace(/^\?/,'').replace(/&amp;/g,'&').split("&");
        
        for (var j=0; j < params.length; j++) {
          var param = params[j].split("=");
          switch ( param[0] ) {
            case "mapId"	: mapId = param[1]; break;
            default : mapId = -1;
          }
        }
		    
		    var proxy = document.domain.indexOf('localhost') != -1 ?  "/proxy/?url=" : "";   		
        var geoStoreBaseURL = "http://192.168.1.130:9191/geostore/rest/";
        
        Ext.Ajax.defaultHeaders = {
          'Accept': "application/json"
        };
        
        Ext.onReady(function(){
            Ext.BLANK_IMAGE_URL = (function() {
                    if (Ext.isIE8 || Ext.isGecko || Ext.isOpera || Ext.isChrome) {
                        return "data:image/gif;base64,R0lGODlhAQABAID/AMDAwAAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==";
                    } else {
                        return "theme/app/img/blank.gif";
                    }
            })();

            OpenLayers.ImgPath = "externals/openlayers/img/";
            Proj4js.defs["EPSG:102113"]="+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs";

            gxp.plugins.ZoomToExtent.prototype.closest = false;
                        
            Ext.ux.IFrameComponent = Ext.extend(Ext.BoxComponent, {
                 onRender : function(ct, position){
                      this.el = ct.createChild({
                        tag: 'iframe',
                        id: 'iframe-'+ this.id,
                        frameBorder: 0, 
                        src: this.url
                      });
                 }
            });
            
            var appTabs = new Ext.Panel({
                region: 'center',
                layout:'fit', 
                border : false,
                id : 'appTabs'
            });         
            
            var aboutButton = new Ext.Button({
                text: GeoExplorer.prototype.appInfoText,
                iconCls: "icon-geoexplorer",
                handler: function(){
                    var appInfo = new Ext.Panel({
                        header: false,
                        html: "<iframe style='border: none; height: 100%; width: 100%' src='about.html' frameborder='0' border='0'><a target='_blank' href='about.html'>"+ GeoExplorer.prototype.aboutText+"</a> </iframe>"
                    });

                    var win = new Ext.Window({
                        title:  GeoExplorer.prototype.aboutThisMapText,
                        modal: true,
                        layout: "fit",
                        width: 300,
                        height: 300,
                        items: [appInfo]
                    });
                    win.show();
                }
            });
            
            var poweredByGeoSol = new Ext.Button({
                tooltip: 'Powered by GeoSolutions',
                iconCls: "icon-geosol",
                width : 150,
                handler: function(btn){
                    window.open('http://geo-solutions.it/contact/', '_blank');
                }
            });    
			
            var appViewport = new Ext.Viewport({
                id: 'appVieport',
                layout:'fit',
                border:false,
                items: [{
                    region : 'center',
                    layout : 'border',
                    border : false,
                    header : false,                    
                    items : [appTabs],                            
                    bbar : [
                      poweredByGeoSol, ' ', aboutButton
                    ]
                }]
            });
			      
            app = new GeoExplorer.Composer({
                modified: false,
                proxy: "proxy/?url=",
                xmlJsonTranslateService: "http://demo1.geo-solutions.it/xmlJsonTranslate/",
                defaultSourceType: "gxp_wmssource",
                renderToTab : 'appTabs',
                about: {
                    title: "Fouta Djallon Higlands programme",
                    'abstract': "Fouta Djallon Higlands comment",
                    contact: "<a href='http://www.fouta-djallon-programme.org/'>http://www.fouta-djallon-programme.org/</a>."
                },
                sources: {
                    fdh: {
                        url: "http://demo1.geo-solutions.it/geoserver/ows",
                        title: "FDH GeoServer",
                        layerBaseParams: { 
                            TILED : true,
                            TILESORIGIN: '-20037508.34,-20037508.34'
                        }
                    },
                    mapquest: {
                        ptype: "gxp_mapquestsource"
                    },
                    osm: {
                        ptype: "gxp_osmsource"
                    },
                    google: {
                        ptype: "gxp_googlesource"
                    },
                    bing: {
                        ptype: "gxp_bingsource"
                    },
                    ol: {
                        ptype: "gxp_olsource"
                    }
                },
                map: {
					          projection: "EPSG:900913",
                    units: "m",
                    maxExtent: [
                        -20037508.34, -20037508.34,
                        20037508.34, 20037508.34
                    ],
                    layers: [{
                        source: "bing",
                        title: "Bing Aerial",
                        name: "Aerial",
                        group: "background"
                    }, {
                        source: "osm",
                        title: "Open Street Map",
                        name: "mapnik",
                        group: "background"
                    },{
                        source: "mapquest",
                        title: "MapQuest OpenStreetMap",
                        name: "osm",
                        group: "background"
                    },{
                        source: "google",
                        title: "Google Roadmap",
                        name: "ROADMAP",
                        group: "background"
                    },{
                        source: "google",
                        title: "Google Hybrid",
                        name: "HYBRID",
                        group: "background"
                    },{
                        source: "google",
                        title: "Google Terrain",
                        name: "TERRAIN",
                        group: "background"
                    },{
                        source: "fdh",
                        name: "geonetwork:g2006_continents",
                        visibility : false                        
                    },{
                        source: "fdh",
                        name: "geonetwork:g2006_0gen",
                        visibility : false
                    },{
                        source: "fdh",
                        name: "geonetwork:Boundaries"
                    },{
                        source: "fdh",
                        name: "geonetwork:Pilotsitepolygons",
						            uuid : "46c2a724-e416-4054-9a7a-2af4baf3c948"
                    }],
                    center: [-1224514, 1291331],
                    zoom: 6
                }
            });           
        });
        
    </script>